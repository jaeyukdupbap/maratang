{% extends 'base.html' %}

{% block title %}홈 - MoodGarden{% endblock %}

{% block content %}
<div class="container">
    <h1>마라탕에 오신 것을 환영합니다!</h1>
    
    {% if user.is_authenticated %}
        <div class="welcome-section">
            <h2>안녕하세요, {{ user.username }}님!</h2>
            {% if user_pet %}
                <p>현재 레벨: {{ user_pet.current_level }} | XP: {{ user_pet.current_xp }}</p>
            {% endif %}
            <p>보유 포인트: {{ user.total_points }}P</p>
        </div>
    {% else %}
        <div class="welcome-section">
            <p>커뮤니티 모임에 참여하고 포인트를 모아 동물을 키워보세요. 기부도 할 수 있어요!</p>
            <a href="{% url 'login' %}" class="btn btn-primary">로그인</a>
            <a href="{% url 'signup' %}" class="btn btn-secondary">회원가입</a>
        </div>
    {% endif %}
    
    <div class="section">
        <h2>최근 모임</h2>
        {% if recent_meetings %}
            <div class="meeting-list">
                {% for meeting in recent_meetings %}
                    <div class="meeting-card">
                        <h3><a href="{% url 'meeting_detail' meeting.meeting_id %}">{{ meeting.title }}</a></h3>
                        <p>{{ meeting.description|truncatewords:20 }}</p>
                        <p>장소: {{ meeting.location_name }}</p>
                        <p>일시: {{ meeting.meeting_date|date:"Y-m-d H:i" }}</p>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>아직 생성된 모임이 없습니다.</p>
        {% endif %}
        <a href="{% url 'community' %}" class="btn btn-outline-primary">모든 모임 보기</a>
    </div>
    
    {% if active_pool %}
        <div class="section">
            <h2>진행 중인 기부</h2>
            <div class="donation-card">
                <h3>{{ active_pool.title }}</h3>
                <div class="progress">
                    <div class="progress-bar" style="width: {{ active_pool.get_progress_percentage }}%">
                        {{ active_pool.current_points }} / {{ active_pool.goal_points }} 포인트
                    </div>
                </div>
                <p>{{ active_pool.get_progress_percentage }}% 달성</p>
            </div>
            <a href="{% url 'donation' %}" class="btn btn-outline-primary">기부 페이지로 이동</a>
        </div>
    {% endif %}
</div>
{% endblock %}
