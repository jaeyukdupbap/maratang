{% extends 'base.html' %}

{% block title %}커뮤니티 - MoodGarden{% endblock %}

{% block content %}
<div class="container">
    <h1>커뮤니티 모임</h1>
    
    {% if user.is_authenticated %}
        <a href="{% url 'meeting_create' %}" class="btn btn-primary">모임 생성하기</a>
    {% endif %}
    
    <div class="search-section">
        <form method="get" action="{% url 'community' %}">
            <input type="text" name="search" placeholder="모임 검색..." value="{{ search_query }}" class="form-control">
            <button type="submit" class="btn btn-secondary">검색</button>
        </form>
    </div>
    
    <div class="meeting-list">
        {% if meetings %}
            {% for meeting in meetings %}
                <div class="meeting-card">
                    <h3><a href="{% url 'meeting_detail' meeting.meeting_id %}">{{ meeting.title }}</a></h3>
                    <p>{{ meeting.description|truncatewords:30 }}</p>
                    <div class="meeting-info">
                        <p><strong>호스트:</strong> {{ meeting.host_id.username }}</p>
                        <p><strong>장소:</strong> {{ meeting.location_name }}</p>
                        <p><strong>일시:</strong> {{ meeting.meeting_date|date:"Y-m-d H:i" }}</p>
                        <p><strong>참여자:</strong> {{ meeting.participant_count }} / {{ meeting.capacity }}</p>
                    </div>
                    {% if user.is_authenticated %}
                        {% if meeting.meeting_id in user_participations %}
                            <span class="badge badge-success">참여 중</span>
                        {% endif %}
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <p>모임이 없습니다.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
